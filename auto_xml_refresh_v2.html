<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>XML Refresher</title>
		
	
	<link rel="stylesheet" href="style/jquery-ui.1.8.21.css" type="text/css" media="all"><!-- http://code.jquery.com/ui/1.8.21/themes/base/jquery-ui.css -->
	<link rel="stylesheet" href="style/xml_styles.css" type="text/css" media="all">
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script><!-- 1.10.2 -->
	<script src="js/auto_xml_app.js"></script>
	
	
	<script></script>
	<script></script>
<script>
$(function() {
		//========================================================
		
		function getForm(){
			var form = {};
			form.year = $('select[name=year]').val();
			form.uncache = $('select[name=cache]').val();
			form.model = $('input#search').val();
			return form;			
		}

		
		function getPageOptions(select, pages){		
			var me = select;			
			for(i = 0; i < pages.length; i++){
				var p = pages[i];
				$('<option value=""></option>')
					.attr('value', p.value)
					.html(p.name)
					.appendTo(me);
			}			
		}
		
		// ============ INIT ======================
		$( "#search" ).catcomplete({
			delay: 0,
			source: data,
			minLength: 2,
			select: processSelect
		});
		
		getPageOptions($('select[name=page]'), pages);
		var urlList = $('ul#urlList');
		var baseUrl = 'http://contentpreviewprod.mbusa.com/VGNCFM/cfm?';
		$('input#search').focus();
		$('.results').hide();

		// ============ ! INIT ======================
		
		
		function processSelect(event, ui) { 	
			//genUrls(ui.item.label);
		}
		
		$('button#genUrl').live('click', function(){
			var form = getForm();
			genUrls(form.model);
		});		
		
		function genUrls(modelName){
			var md = modelDetail.findObj(modelName),
				header = $('.heading'),
				form = getForm();
			
			if(!md){ console.log('couldnt find'); }
			
			//-------------------------------------------------
			$('ul#urlList, .heading').empty();			
			$('.results').show();			
			$('<h3></h3>')
				.html(md.name+' ('+ form.year +')')
				.appendTo(header);		
			//-------------------------------------------------
			

			//page=Class_ModelView&class=E&model=E350S4&year=2013&uncache=true/
			
			
			for(k = 0; k < pages.length; k++){
			    // Add title
				$('<li><h4>' + pages[k].title + '</h4></li>').appendTo(urlList);
				
			    
				for(m = 0; m < pages[k].items.length; m++){
					var page = pages[k].items[m], 
						u, isClassPage, isEorC, isCompare;
					
					var param = [
						{name: 'page', value: page.value},
						{name: 'year', value: form.year},
						{name: 'class', value: md.class},
						{name: 'model', value: md.modelCode},
						{name: 'uncache', value: form.uncache},
					];
					
					isClassPage = (page.value == 'Class_Page') ? true : false;
					isEorC = (md.class == 'E' || md.class == 'C') ? true : false;
					isCompare = (page.value == 'Class_Compare' && isEorC) ? true : false;
					
					if(isClassPage || isCompare){
						param.push({ name : 'bodystyle', value : md.bodystyle });
					}
										
					u = param.buildUrl(baseUrl);
						
					$('<li><a href="" target="_blank"></a></li>')
						.find('a').attr('href', u).html(page.name)
						.end().appendTo(urlList);
				}
								
			}	
			return true;			
		}
		

	
	});
	</script>
</head>
<body>
<div id="wrap">

	<div class="container">
		<div class="row">
			<div class="span3">
				<button class="btn btn-small btn-primary" type="button">E-Sedan</button><br>
				<button class="btn btn-small btn-primary" type="button">E-Coupe</button>
			</div>
			<div class="span6">
			
			</div>
		</div>
	</div><!-- !container -->
<hr>
	<div id="main">
		
		<div class="form well">
			<label for="search">Model </label>
			<input id="search" />
			<br>

			<label for="cache">Uncache  </label>
			<select name="cache">
				<option value="true" selected="selected">True</option>
				<option value="false">False</option>
			</select>				
			<br>
			
			<label for="year">Year </label>
			<select name="year">
				<option value="2014" selected="selected">2014</option>
				<option value="2013">2013</option>
			</select>		

			<input type="hidden" name="url" value="" /><br><br>
			
			<label for="year">&nbsp; </label><br>
			<button id="genUrl" class="btn btn-primary">Submit</button>
		</div><!-- !form -->
		
		<div class="results">
			<div class="heading"></div>
			<ul id="urlList"></ul>
		</div><!-- !results -->
	</div>
</div>


</body>
</html>